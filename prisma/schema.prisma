generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Admin {
  id            Int             @id @default(autoincrement())
  username      String          @unique
  password      String
  name          String
  email         String
  createdAt     DateTime        @default(now())
  SoftwareAsset SoftwareAsset[]
}

model Department {
  id     Int             @id @default(autoincrement())
  name   String          @unique
  assets SoftwareAsset[]
}

model Vendor {
  id           Int             @id @default(autoincrement())
  name         String          @unique
  contactName  String?
  contactEmail String?
  contactPhone String?
  notes        String?         @db.Text
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  assets       SoftwareAsset[]
}

model SoftwareAsset {
  id               Int               @id @default(autoincrement())
  name             String
  category         AssetCategory
  status           AssetStatus       @default(active)
  expiryDate       DateTime
  ownerAdminId     Int
  vendorId         Int?
  departmentId     Int?
  purchaseDate     DateTime?
  renewalCycle     RenewalCycle?
  autoRenew        Boolean           @default(false)
  cost             Decimal?          @db.Decimal(12, 2)
  currency         String            @default("KRW")
  billingCycle     BillingCycle      @default(monthly)
  seatsTotal       Int?
  seatsUsed        Int?
  purchaseChannel  String?
  description      String?           @db.Text
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  assignments      AssetAssignment[]
  notificationLogs NotificationLog[]
  department       Department?       @relation(fields: [departmentId], references: [id])
  owner            Admin             @relation(fields: [ownerAdminId], references: [id])
  vendor           Vendor?           @relation(fields: [vendorId], references: [id])

  @@index([expiryDate])
  @@index([status])
  @@index([category])
  @@index([vendorId])
  @@index([departmentId])
  @@index([ownerAdminId], map: "SoftwareAsset_ownerAdminId_fkey")
}

model AssetAssignment {
  id         Int           @id @default(autoincrement())
  assetId    Int
  userName   String
  userEmail  String?
  assignedAt DateTime      @default(now())
  returnedAt DateTime?
  notes      String?
  asset      SoftwareAsset @relation(fields: [assetId], references: [id], onDelete: Cascade)

  @@index([assetId])
}

model NotificationLog {
  id      Int           @id @default(autoincrement())
  assetId Int
  rule    String
  sentAt  DateTime      @default(now())
  asset   SoftwareAsset @relation(fields: [assetId], references: [id])

  @@unique([assetId, rule, sentAt])
}

enum AssetCategory {
  collaboration
  devtool
  designtool
  infrastructure
  security
  other
}

enum AssetStatus {
  active
  expiring
  expired
  terminated
  on_hold
}

enum RenewalCycle {
  m1
  m3
  m6
  y1
  y3
  one_time
}

enum BillingCycle {
  monthly
  yearly
  one_time
  none
}
